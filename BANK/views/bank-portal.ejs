<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bank Core v2.0 - Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">

    <nav class="bg-indigo-900 text-white p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl font-bold flex items-center">
                <i class="fa-solid fa-vault mr-2 text-yellow-400"></i> BANK_CORE PRO
            </h1>
            <div id="connection-status" class="text-xs bg-green-500 px-3 py-1 rounded-full">SYSTEM ACTIVE</div>
        </div>
    </nav>

    <div class="flex flex-1 container mx-auto my-6 gap-6 px-4">
        
        <aside class="w-1/4 bg-white rounded-xl shadow-lg p-6 h-fit sticky top-6">
            <h2 class="text-gray-400 uppercase text-xs font-bold tracking-widest mb-4">Operations</h2>
            <nav class="space-y-2">
                <button onclick="switchTab('create')" id="tab-create" class="tab-btn w-full flex items-center p-3 rounded-lg bg-indigo-600 text-white font-semibold transition">
                    <i class="fa-solid fa-user-plus mr-3"></i> Create Account
                </button>
                <button onclick="switchTab('check')" id="tab-check" class="tab-btn w-full flex items-center p-3 rounded-lg text-gray-600 hover:bg-indigo-50 transition">
                    <i class="fa-solid fa-magnifying-glass-dollar mr-3"></i> Check Balance
                </button>
                <button onclick="switchTab('deposit')" id="tab-deposit" class="tab-btn w-full flex items-center p-3 rounded-lg text-gray-600 hover:bg-indigo-50 transition">
                    <i class="fa-solid fa-money-bill-transfer mr-3"></i> Make Deposit
                </button>
            </nav>
        </aside>

        <main class="flex-1">
            <div id="alert-container" class="fixed top-20 right-5 z-50 space-y-3 w-80"></div>

            <section id="section-create" class="form-section bg-white rounded-xl shadow-lg p-10 border-t-4 border-indigo-600">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Open New Account</h2>
                <p class="text-gray-500 mb-8 border-b pb-4">Register a new student account in the ledger.</p>
                <form id="createForm" class="grid grid-cols-2 gap-6">
                    <div class="col-span-2">
                        <label class="block text-sm font-semibold text-gray-700">Account Number</label>
                        <input type="text" id="regAcc" class="w-full mt-2 p-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-400 outline-none" placeholder="e.g. ACC-2025-01" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700">Secret Pin</label>
                        <input type="password" id="regSecret" class="w-full mt-2 p-3 border border-gray-200 rounded-lg" placeholder="••••" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700">Initial Deposit ($)</label>
                        <input type="number" id="regBal" class="w-full mt-2 p-3 border border-gray-200 rounded-lg" value="1000">
                    </div>
                    <button type="submit" class="col-span-2 bg-indigo-600 text-white py-4 rounded-lg font-bold hover:bg-indigo-700 transition shadow-lg">
                        Confirm Registration
                    </button>
                </form>
            </section>

            <section id="section-check" class="form-section hidden bg-white rounded-xl shadow-lg p-10 border-t-4 border-emerald-500">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Balance Inquiry</h2>
                <p class="text-gray-500 mb-8">Search for account holdings and status.</p>
                <div class="flex gap-4 mb-10">
                    <input type="text" id="checkAcc" class="flex-1 p-4 border border-gray-200 rounded-lg outline-none focus:ring-2 focus:ring-emerald-400" placeholder="Enter Account Number">
                    <button onclick="handleCheck()" class="bg-emerald-600 text-white px-8 py-4 rounded-lg font-bold hover:bg-emerald-700 transition">Search</button>
                </div>
                <div id="balanceDisplay" class="hidden text-center bg-gray-50 p-10 rounded-2xl border-2 border-dashed border-gray-200">
                    <span class="text-gray-400 font-bold uppercase text-xs tracking-widest">Available Funds</span>
                    <div class="text-6xl font-black text-emerald-600 mt-2">$<span id="balVal">0.00</span></div>
                </div>
            </section>

            <section id="section-deposit" class="form-section hidden bg-white rounded-xl shadow-lg p-10 border-t-4 border-yellow-500">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Cash Deposit</h2>
                <p class="text-gray-500 mb-8">Increase account balance via secure deposit.</p>
                <div class="space-y-6 max-w-md mx-auto">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700">Target Account</label>
                        <input type="text" id="depAcc" class="w-full mt-2 p-3 border border-gray-200 rounded-lg" placeholder="Account #">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700">Deposit Amount ($)</label>
                        <input type="number" id="depAmt" class="w-full mt-2 p-3 border border-gray-200 rounded-lg" placeholder="0.00">
                    </div>
                    <button onclick="handleDeposit()" class="w-full bg-yellow-500 text-white py-4 rounded-lg font-bold hover:bg-yellow-600 transition shadow-lg">
                        Finalize Deposit
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        // --- UI SWITCHING LOGIC ---
        function switchTab(tabName) {
            // Hide all sections
            document.querySelectorAll('.form-section').forEach(s => s.classList.add('hidden'));
            // Remove active styles from buttons
            document.querySelectorAll('.tab-btn').forEach(b => {
                b.classList.remove('bg-indigo-600', 'text-white');
                b.classList.add('text-gray-600', 'hover:bg-indigo-50');
            });

            // Show current section
            document.getElementById(`section-${tabName}`).classList.remove('hidden');
            // Add active styles to current button
            const activeBtn = document.getElementById(`tab-${tabName}`);
            activeBtn.classList.remove('text-gray-600', 'hover:bg-indigo-50');
            activeBtn.classList.add('bg-indigo-600', 'text-white');
        }

        // --- TOAST NOTIFICATIONS ---
        function notify(message, type = 'success') {
            const container = document.getElementById('alert-container');
            const toast = document.createElement('div');
            toast.className = `p-4 rounded-lg shadow-2xl border-l-4 flex justify-between items-center bg-white ${type === 'success' ? 'border-green-500' : 'border-red-500'}`;
            toast.innerHTML = `<span>${type === 'success' ? '✅' : '❌'} ${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        // --- API CALLS ---
        document.getElementById('createForm').onsubmit = async (e) => {
            e.preventDefault();
            try {
                await axios.post('/bank/create', {
                    accountNumber: document.getElementById('regAcc').value,
                    secret: document.getElementById('regSecret').value,
                    balance: document.getElementById('regBal').value
                });
                notify("Account registered successfully!");
                e.target.reset();
            } catch (err) { notify("Registration failed!", "error"); }
        };

        async function handleCheck() {
            const acc = document.getElementById('checkAcc').value;
            try {
                const res = await axios.get(`/bank/balance/${acc}`);
                document.getElementById('balanceDisplay').classList.remove('hidden');
                document.getElementById('balVal').innerText = res.data.balance.toLocaleString();
            } catch (err) { notify("Account not found", "error"); }
        }

        async function handleDeposit() {
            const acc = document.getElementById('depAcc').value;
            const amt = document.getElementById('depAmt').value;
            try {
                await axios.post('/bank/deposit', { accountNumber: acc, amount: amt });
                notify("Funds added successfully!");
                switchTab('check'); // Redirect to check balance tab to show new balance
                document.getElementById('checkAcc').value = acc;
                handleCheck();
            } catch (err) { notify("Deposit failed!", "error"); }
        }
    </script>
</body>
</html>